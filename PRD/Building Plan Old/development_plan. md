# ×ª×•×›× ×™×ª ×¤×™×ª×•×— ××•×§××¤ - Bid Optimizer

## ××˜×¨×”
×¤×™×ª×•×— ××•×§××¤ ×¤×•× ×§×¦×™×•× ×œ×™ ××œ× ×©×œ ××¤×œ×™×§×¦×™×™×ª Bid Optimizer ×‘×©×œ×•×©×” ×©×œ×‘×™× (Upload, Validate, Output).
×”××•×§××¤ ×›×•×œ×œ ××ª ×›×œ ×”-UI ×•×”×–×¨×™××” ×”××œ××”, ××š ×œ×œ× ×—×™×©×•×‘×™ ××•×¤×˜×™××™×–×¦×™×” ×××™×ª×™×™×.

**×—×©×•×‘**: ×–×”×• ××•×§××¤ ×¤×•× ×§×¦×™×•× ×œ×™ ××œ×, ×œ× ×“××• ×•×™×–×•××œ×™. ×”××¤×œ×™×§×¦×™×” ×¦×¨×™×›×” ×œ×¢×‘×•×“ ×‘×××ª - ×œ×§×¨×•× ×§×‘×¦×™×, ×œ× ×”×œ Virtual Map, ×•×œ×™×¦×•×¨ ×§×‘×¦×™ output (×–×”×™× ×œ××§×•×¨ ×‘××•×§××¤).

## ×¡×˜×˜×•×¡ × ×•×›×—×™
×”××¤×œ×™×§×¦×™×” × ××¦××ª ×‘×××¦×¢ Phase 2 (×ª×©×ª×™×ª ×•×§×‘×¦×™ ×‘×¡×™×¡).

## ×¢×¥ ×”×¤×¨×•×™×§×˜ ×”××œ×

```
project/
â”œâ”€â”€ .streamlit/
â”‚   â””â”€â”€ config.toml
â”‚
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ state/
â”‚   â”‚   â””â”€â”€ session.py                    # ğŸ”„ ×“×•×¨×© ×”×•×¡×¤×ª ××•× ×” ××™×˜×¨×¦×™×•×ª
â”‚   â””â”€â”€ ui/
â”‚       â”œâ”€â”€ layout.py
â”‚       â”œâ”€â”€ messages.py
â”‚       â”œâ”€â”€ style.py
â”‚       â”œâ”€â”€ widgets.py
â”‚       â””â”€â”€ tabs/
â”‚           â”œâ”€â”€ upload_tab.py
â”‚           â”œâ”€â”€ validate_tab.py           # ğŸ”„ ×“×•×¨×© ×”×¤×¨×“×ª ×œ×•×’×™×§×” ×-UI
â”‚           â””â”€â”€ output_tab.py
â”‚
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ constants.py
â”‚   â”œâ”€â”€ settings.py
â”‚   â””â”€â”€ ui_text.py
â”‚
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ errors/
â”‚   â”‚   â””â”€â”€ messages.yaml                # ×§×™×™× - ×§×•×‘×¥ ×”×•×“×¢×•×ª ×©×’×™××”
â”‚   â”œâ”€â”€ io/
â”‚   â”‚   â”œâ”€â”€ readers.py
â”‚   â”‚   â””â”€â”€ writers.py
â”‚   â”œâ”€â”€ mapping/
â”‚   â”‚   â””â”€â”€ virtual_map.py
â”‚   â”œâ”€â”€ output/
â”‚   â”‚   â””â”€â”€ files_builder.py             # ×›×•×œ×œ ×’× ×™×¦×™×¨×ª ×©××•×ª ×§×‘×¦×™×
â”‚   â””â”€â”€ validate/
â”‚       â”œâ”€â”€ bulk_cleanse.py
â”‚       â”œâ”€â”€ portfolio_comparison.py       # â• ×—×“×© - ×¨×™×§, ×“×•×¨×© ××™××•×©
â”‚       â”œâ”€â”€ completion_validator.py       # â• ×—×“×© - ×¨×™×§, ×“×•×¨×© ××™××•×©
â”‚       â””â”€â”€ titles.py
â”‚
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ file_schemas.py
â”‚   â”œâ”€â”€ portfolio.py
â”‚   â”œâ”€â”€ state.py
â”‚   â””â”€â”€ step2_models.py                   # â• ×—×“×© - ×¨×™×§, ×“×•×¨×© ××™××•×©
â”‚
â”œâ”€â”€ optimizers/
â”‚   â”œâ”€â”€ base.py
â”‚   â””â”€â”€ zero_sales/
â”‚       â”œâ”€â”€ optimizer.py
â”‚       â””â”€â”€ processors/
â”‚           â”œâ”€â”€ data_cleaner.py
â”‚           â””â”€â”€ sheet_creator.py
â”‚
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ portfolio_service.py
â”‚   â””â”€â”€ step2_service.py                  # â• ×—×“×© - ×¨×™×§, ×“×•×¨×© ××™××•×© (×›×•×œ×œ × ×™×”×•×œ Virtual Map)
â”‚
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ debug_manager.py
â”‚   â”œâ”€â”€ file_utils.py
â”‚   â””â”€â”€ format_utils.py
â”‚
â”œâ”€â”€ PRD/                                  # ×ª×™×§×™×™×ª ××™×¤×™×•×Ÿ
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ fixtures/                         # â• ×œ×”×•×¡×™×£ ×‘×”××©×š
â”‚       â”œâ”€â”€ valid/                        # ×§×‘×¦×™ ×‘×“×™×§×” ×ª×§×™× ×™×
â”‚       â”œâ”€â”€ invalid/                      # ×§×‘×¦×™ ×‘×“×™×§×” ×©×’×•×™×™×
â”‚       â””â”€â”€ edge_cases/                   # ××§×¨×™ ×§×¦×”
â”œâ”€â”€ .gitignore
â”œâ”€â”€ README.md
â””â”€â”€ requirements.txt

## ×§×‘×¦×™× ×œ××—×™×§×”:
âŒ app/pages/ (×ª×™×§×™×™×” ×¨×™×§×”)
âŒ services/file_io/ (×›×¤×™×œ×•×ª ×¢× core/io)
âŒ services/virtual_map_service.py (×™×•×¢×‘×¨ ×œ-step2_service)
âŒ utils/session_manager.py (×›×¤×™×œ×•×ª ×¢× app/state/session)
âŒ core/output/filenames.py (×™×•×¢×‘×¨ ×œ-files_builder)
```

---

## Phase 1: ××‘× ×” ×¤×¨×•×™×§×˜ ×‘×¡×™×¡×™ âœ… ×”×•×©×œ× 100%

### ××” ×‘×•×¦×¢:
- âœ… ××‘× ×” ×ª×™×§×™×•×ª ××œ×
- âœ… ×§×•×‘×¥ `app/main.py` - × ×§×•×“×ª ×›× ×™×¡×” ×¨××©×™×ª
- âœ… ×©×œ×•×©×” ×˜××‘×™×: Upload, Validate, Output
- âœ… ×§×‘×¦×™ `__init__.py` ×‘×›×œ ×”×ª×™×§×™×•×ª
- âœ… ×§×•×‘×¥ `requirements.txt`
- âœ… ×ª×¦×•×¨×ª Streamlit (`.streamlit/config.toml`)
- âœ… ×§×‘×¦×™ ×“×•×’××”: `Empty Template Example.xlsx`, `Bulk File Example.xlsx`

---

## Phase 2: ×ª×©×ª×™×ª ×•×§×‘×¦×™ ×‘×¡×™×¡ âœ… ×”×•×©×œ× 90%

### ××” ×‘×•×¦×¢:
- âœ… `config/settings.py` - ×”×’×“×¨×•×ª ××¤×œ×™×§×¦×™×”
- âœ… `config/constants.py` - ×§×‘×•×¢×™× (×’×“×œ×™ ×§×‘×¦×™×, ×¢××•×“×•×ª × ×“×¨×©×•×ª)
- âœ… `config/ui_text.py` - ×›×œ ×”×˜×§×¡×˜×™× ×©×œ ×”-UI
- âœ… `app/state/session.py` - × ×™×”×•×œ Session State (×“×•×¨×© ×¢×“×›×•×Ÿ ×§×œ)
- âœ… `app/ui/layout.py` - ×ª×¦×•×¨×ª ×¢××•×“ ×•×¤×¨×™×¡×” (×›×•×œ×œ CSS ××•×ª××)
- âœ… `app/ui/widgets.py` - ×¨×›×™×‘×™ UI ×œ×©×™××•×© ×—×•×–×¨
- âœ… `app/ui/messages.py` - ×”×•×“×¢×•×ª ×©×’×™××”/×”×¦×œ×—×”/××–×”×¨×” (×›×•×œ×œ pink notice)
- âœ… `app/ui/style.py` - ×¢×™×¦×•×‘ ××œ× (×›×¤×ª×•×¨×™× ××“×•××™×, ×œ×œ× ××™××•×’'×™, ×¤×¨×™×¡×” 1:6:1)

### ××” ×—×¡×¨:
- âŒ `core/io/readers.py` - ×§×¨×™××ª ×§×‘×¦×™ Excel/CSV
- âŒ `core/io/writers.py` - ×›×ª×™×‘×ª ×§×‘×¦×™ Excel
- âŒ `core/validate/bulk_cleanse.py` - × ×™×§×•×™ ×¨××©×•× ×™
- âŒ `core/mapping/virtual_map.py` - × ×™×”×•×œ Virtual Map

---

## Phase 3: ××™××•×© ×˜××‘×™× ğŸ”„ ×”×•×©×œ× 75-80%

### Upload Tab - âœ… ×”×•×©×œ× 100%
- âœ… `app/ui/tabs/upload_tab.py` - ××•××© ×‘××œ×•××•
- âœ… ×”×•×¨×“×ª template ×¨×™×§
- âœ… ×”×¢×œ××ª Template ×•-Bulk
- âœ… ×‘×—×™×¨×ª Zero Sales
- âœ… ×”×•×“×¢×•×ª ×¡×˜×˜×•×¡
- âœ… ×•×œ×™×“×¦×™×•×ª ×•×™×–×•××œ×™×•×ª

### Validate Tab - ğŸ”„ ×“×•×¨×© ×©×›×ª×•×‘
- âœ… `app/ui/tabs/validate_tab.py` - UI ×§×™×™× ××‘×œ ×“×•×¨×© ×”×¤×¨×“×ª ×œ×•×’×™×§×”
- âœ… **Mockup Scenario Selector** - ×—×•×‘×” ×œ×”×©××™×¨! 
- âŒ **×—×¡×¨**: ×”×¤×¨×“×ª ×œ×•×’×™×§×” ×¢×¡×§×™×ª ×-UI
- âŒ **×—×¡×¨**: ×× ×’× ×•×Ÿ ×¡×¤×™×¨×ª ××™×˜×¨×¦×™×•×ª

### Output Tab - âœ… ×”×•×©×œ× 75%
- âœ… `app/ui/tabs/output_tab.py` - UI ××œ× ×•×¤×•× ×§×¦×™×•× ×œ×™
- âœ… ×× ×™××¦×™×™×ª ×¢×™×‘×•×“ ×¢× Progress Bar
- âœ… ×›×¤×ª×•×¨×™ ×”×•×¨×“×” (Working File, Clean File)
- âœ… Pink Notice ×œ×©×’×™××•×ª ×—×™×©×•×‘
- âœ… ×”×•×“×¢×•×ª Info ×¢×œ bids ××—×•×¥ ×œ×˜×•×•×—
- âœ… ×¡×˜×˜×™×¡×˜×™×§×•×ª ××•×§××¤
- âœ… ×›×¤×ª×•×¨ New Processing
- âŒ **×—×¡×¨**: ×™×¦×™×¨×ª ×§×‘×¦×™ output ×××™×ª×™×™×
- âŒ **×—×¡×¨**: ×©××•×ª ×§×‘×¦×™× ×¢× ×ª××¨×™×š ×•×©×¢×” ×“×™× ××™×™×

---

## Phase 4: ×œ×•×’×™×§×” ×‘×¡×™×¡×™×ª ×œ××•×§××¤ ğŸ”„ ×”×ª×—×™×œ 10% - **×¢×“×™×¤×•×ª ×¢×œ×™×•× ×”**

### ××” ×‘×•×¦×¢:
- âœ… `core/validate/portfolios.py` - **× ××—×§** 
- âœ… `core/validate/portfolio_comparison.py` - **× ×•×¦×¨ ×¨×™×§**
- âœ… `core/validate/completion_validator.py` - **× ×•×¦×¨ ×¨×™×§**
- âœ… `services/step2_service.py` - **× ×•×¦×¨ ×¨×™×§**
- âœ… `models/step2_models.py` - **× ×•×¦×¨ ×¨×™×§**

### ××” ×¦×¨×™×š ×œ×××© ×‘×“×—×™×¤×•×ª:

#### ğŸ”´ ×§×‘×¦×™× ×¨×™×§×™× ×§×¨×™×˜×™×™× (×™×•× 1):
1. **`services/step2_service.py`** - **×”×›×™ ×§×¨×™×˜×™!** ×¦×¨×™×š ×œ×××©:
   - × ×™×”×•×œ ×›×œ ×”×ª×”×œ×™×š ×©×œ Step 2
   - × ×™×”×•×œ Virtual Map
   - ××•× ×” ××™×˜×¨×¦×™×•×ª (MAX=10)
   - ×ª×–××•×¨ ×‘×™×Ÿ ×›×œ ×”×¤×¢×•×œ×•×ª

2. **`core/validate/portfolio_comparison.py`** - ×¦×¨×™×š ×œ×××©:
   - ×¤×•× ×§×¦×™×™×ª `compare_portfolios(bulk_df, virtual_map)`
   - ×¤×•× ×§×¦×™×™×ª `get_missing_portfolios()`
   - ×¤×•× ×§×¦×™×™×ª `get_excess_portfolios()`
   - **×”×¢×¨×”**: ××—×œ×™×£ ××ª ×”×§×•×‘×¥ ×”×™×©×Ÿ portfolios.py

3. **`core/validate/completion_validator.py`** - ×¦×¨×™×š ×œ×××©:
   - ×•×œ×™×“×¦×™×” ×©×œ completion template
   - ×‘×“×™×§×ª ×¢×¨×›×™ Base Bid
   - ×‘×“×™×§×” ×©×¤×•×¨×˜×¤×•×œ×™×• ×§×™×™× ×‘×‘××œ×§

4. **`models/step2_models.py`** - ×¦×¨×™×š ×œ×××©:
   - ComparisonResult dataclass
   - ValidationError dataclass
   - Step2State dataclass

#### ğŸŸ¡ ×ª×™×§×•× ×™× ×“×—×•×¤×™× (×™×•× 2):
5. **`app/state/session.py`** - ×œ×”×•×¡×™×£:
   - `completion_iteration_count: int = 0`
   - `MAX_ITERATIONS = 10`

6. **`app/ui/tabs/validate_tab.py`** - ×©×›×ª×•×‘:
   - ×œ×”×¢×‘×™×¨ ×›×œ ×”×œ×•×’×™×§×” ×œ-`services/step2_service.py`
   - ×œ×”×©××™×¨ ×¨×§ ×§×¨×™××•×ª ×œ×¡×¨×•×•×™×¡ ×•×ª×¦×•×’×ª UI

#### âœ… ×§×‘×¦×™× ×§×™×™××™× ×œ×‘×“×™×§×”:
7. **`core/io/readers.py` ×•-`writers.py`** - ×œ×‘×“×•×§ ×× ×¢×•×‘×“×™×
8. **`core/mapping/virtual_map.py`** - ×œ×‘×“×•×§ ×× ××œ× ×•×¢×•×‘×“
9. **`core/validate/bulk_cleanse.py`** - ×œ×‘×“×•×§ ×× ×¢×•×‘×“
10. **`core/output/files_builder.py`** - ×œ×”×•×¡×™×£ ×¤×•× ×§×¦×™×•×ª ×-filenames.py ×©× ××—×§

#### 6. ×™×¦×™×¨×ª ×§×‘×¦×™ Output
- `core/output/files_builder.py` - ×™×¦×™×¨×ª Working/Clean Files (×§×™×™×, ×¦×¨×™×š ×œ×‘×“×•×§)
- `core/output/filenames.py` - ×©××•×ª ×§×‘×¦×™× ×“×™× ××™×™× (×§×™×™×, ×¦×¨×™×š ×œ×‘×“×•×§)

---

## Phase 5: ××™× ×˜×’×¨×¦×™×” ×•×—×™×‘×•×¨ â³ ×˜×¨× ×”×—×œ

### ××” ×¦×¨×™×š ×œ×¢×©×•×ª:

1. **×—×™×‘×•×¨ Step 1 (Upload) ×œ×œ×•×’×™×§×”**:
   - ×•×œ×™×“×¦×™×” ×××™×ª×™×ª ×©×œ headers
   - ×‘×“×™×§×ª ×’×•×“×œ ×§×•×‘×¥ (40MB)
   - ×‘×“×™×§×ª ×§×™×•× sheet "Sponsored Products Campaigns"

2. **×©×›×ª×•×‘ Step 2 (Validate)**:
   - **×œ×©××•×¨ ××ª Mockup Scenario Selector!**
   - ×”×¢×‘×¨×ª ×›×œ ×”×œ×•×’×™×§×” ×œ-`services/step2_service.py`
   - ×”×©××¨×ª ×¨×§ UI ×‘-`validate_tab.py`
   - ×”×•×¡×¤×ª ××•× ×” ××™×˜×¨×¦×™×•×ª ×‘-`session.py`

3. **×—×™×‘×•×¨ Step 3 (Output) ×œ×œ×•×’×™×§×”**:
   - ×™×¦×™×¨×ª ×§×‘×¦×™× ×××™×ª×™×™× (×–×”×™× ×œ××§×•×¨)
   - ×©××•×ª ×§×‘×¦×™× ×“×™× ××™×™×
   - Operation = "Update" ×‘×›×œ ×”×©×•×¨×•×ª

---

## Phase 6: ×‘×“×™×§×•×ª ×•×œ×™×˜×•×© â³ ×˜×¨× ×”×—×œ

### ×‘×“×™×§×•×ª × ×“×¨×©×•×ª:
- [ ] ×”×¢×œ××ª ×§×•×‘×¥ 40MB
- [ ] ×”×¢×œ××ª ×§×•×‘×¥ ×¢× headers ×©×’×•×™×™×
- [ ] ×œ×•×œ××ª Completion (3 ××™×˜×¨×¦×™×•×ª)
- [ ] ××’×‘×œ×ª 10 ××™×˜×¨×¦×™×•×ª
- [ ] ×ª×¨×—×™×© missing ×‘×œ×‘×“
- [ ] ×ª×¨×—×™×© excess ×‘×œ×‘×“
- [ ] ×ª×¨×—×™×© missing + excess
- [ ] ×›×¤×ª×•×¨ Reset (New Processing)
- [ ] ××¢×‘×¨ ×—×œ×§ ×‘×™×Ÿ ×˜××‘×™×
- [ ] **×‘×“×™×§×” ×¢× Mockup Scenario Selector**

### × ×™×§×™×•×Ÿ ×§×•×“:
- [ ] **×œ× ×œ×”×¡×™×¨ ××ª Mockup Scenario Selector** - ×–×” × ×©××¨!
- [ ] ×”×¡×¨×ª debug prints (×× ×™×©)
- [ ] ×”×¡×¨×ª TODO comments
- [ ] ×•×™×“×•× ×©×›×œ ×”×˜×§×¡×˜×™× ×‘×× ×’×œ×™×ª
- [ ] ×•×™×“×•× ×©××™×Ÿ ××™××•×’'×™ ××• ××™×™×§×•× ×™×

---

## ×¡×“×¨ ×¢×“×™×¤×•×™×•×ª ××¢×•×“×›×Ÿ ×œ×”××©×š ×¤×™×ª×•×—

### ×¡×“×¨ ×‘×™×¦×•×¢ ××•××œ×¥ - 3 ×™××™×

#### ×™×•× 1 - ×”×§×‘×¦×™× ×”×§×¨×™×˜×™×™×:
1. **×‘×•×§×¨**: `services/step2_service.py` - ×”×× ×•×¢ ×”××¨×›×–×™
2. **×¦×”×¨×™×™×**: 3 ×”×§×‘×¦×™× ×”×¨×™×§×™×:
   - `core/validate/portfolio_comparison.py`
   - `core/validate/completion_validator.py`
   - `models/step2_models.py`

#### ×™×•× 2 - ×ª×™×§×•× ×™× ×•×©×›×ª×•×‘×™×:
3. **×‘×•×§×¨**: `app/state/session.py` - ×”×•×¡×¤×ª ××•× ×” ××™×˜×¨×¦×™×•×ª
4. **×¦×”×¨×™×™×**: `app/ui/tabs/validate_tab.py` - ×”×¤×¨×“×ª ×œ×•×’×™×§×”

#### ×™×•× 3 - ××™× ×˜×’×¨×¦×™×” ×•×‘×“×™×§×•×ª:
5. **×‘×•×§×¨**: ×‘×“×™×§×ª ×§×‘×¦×™× ×§×™×™××™× ×•×—×™×‘×•×¨×™×
6. **×¦×”×¨×™×™×**: ×‘×“×™×§×•×ª ××™× ×˜×’×¨×¦×™×” ××œ××•×ª

### ×¤×§×•×“×•×ª ×œ××—×™×§×ª ×›×¤×™×œ×•×™×•×ª (×× ×¢×“×™×™×Ÿ ×§×™×™××•×ª):
```bash
rm -rf app/pages
rm -rf services/file_io
rm services/virtual_map_service.py
rm utils/session_manager.py
rm core/output/filenames.py
```

---

## ×”×¢×¨×•×ª ×§×¨×™×˜×™×•×ª

1. **×–×”×• ××•×§××¤ ×¤×•× ×§×¦×™×•× ×œ×™, ×œ× ×“××•** - ×”×›×œ ×¦×¨×™×š ×œ×¢×‘×•×“ ×‘×××ª
2. **Mockup Scenario Selector × ×©××¨** - ×–×” ×¤×™×¦'×¨ ×—×©×•×‘ ×œ×‘×“×™×§×•×ª
3. **Virtual Map ×”×•× ×§×¨×™×˜×™** - ×–×” ×”×× ×’× ×•×Ÿ ×”××¨×›×–×™
4. **××’×‘×œ×ª 10 ××™×˜×¨×¦×™×•×ª** - ×“×¨×™×©×” ××”××™×¤×™×•×Ÿ
5. **×”×¡×˜×™×™×œ×™× ×’ ×§×™×™× ×•××œ×** - ×›×¤×ª×•×¨×™× ××“×•××™×, ×œ×œ× ××™××•×’'×™, ×¤×¨×™×¡×” ××“×•×™×§×ª
6. **×™×© ×§×‘×¦×™ ×“×•×’××”** - ×œ×”×©×ª××© ×‘×”× ×œ×‘×“×™×§×•×ª

---

## Timeline ××©×•×¢×¨

| Phase | ×–××Ÿ ××©×•×¢×¨ | ×¡×˜×˜×•×¡ | ×”×¢×¨×•×ª |
|-------|----------|--------|--------|
| Phase 1 | ×”×•×©×œ× | âœ… 100% | ××‘× ×” ××œ× |
| Phase 2 | ×”×•×©×œ× | âœ… 90% | ×¨×§ ×œ×•×’×™×§×ª core ×—×¡×¨×” |
| Phase 3 | ×”×•×©×œ× | âœ… 75-80% | UI ××œ×, ×œ×•×’×™×§×” ×“×•×¨×©×ª ×”×¤×¨×“×” |
| Phase 4 | 2 ×™××™× | ğŸ”„ 10% | **×¢×“×™×¤×•×ª ×¢×œ×™×•× ×”** - ×§×‘×¦×™× × ×•×¦×¨×• |
| Phase 5 | 1 ×™×•× | â³ 0% | ××™× ×˜×’×¨×¦×™×” |
| Phase 6 | 1 ×™×•× | â³ 0% | ×‘×“×™×§×•×ª |

**×¡×”"×› ×–××Ÿ × ×•×ª×¨: 4-5 ×™××™×**

---

*××¡××š ×–×” ××—×œ×™×£ ××ª `PRD/development_plan.md` ×”×§×™×™×*